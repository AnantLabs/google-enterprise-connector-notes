#summary Install the Google Enterprise Connector for Lotus Notes

= Installation Instructions =
The *Google Enterprise Connector For Lotus Notes* is installed entirely on your Domino infrastructure. 

You should install the connector to a domino server to which you have administrative access.

==Lotus Notes Environment Preparation==
You will need to complete the following tasks to install the connector.

===Install Dependent Java Libraries===
The Connector uses the Jakarta Commons HttpClient software to post content to the GSA so before any feeding can begin, these files must be copied to your Domino Server.

1. Download the Commons clients from the [http://hc.apache.org/httpclient-3.x/ Jakarta HTTP Client home page]. 

You will need the following jars:
 * commons-codec-1.3.jar
 * commons-httpclient-3.0.jar
 * commons-logging.jar

2. Copy them to your Domino Server's external Java classes’ folder. On a Microsoft Windows platform, this folder is the *“jvm\lib\ext”* folder, which is located beneath the Domino program folder. For example: If you install Domino to *“C:\Lotus\Domino”*, you would copy your jar files to: *“C:\Lotus\Domino\jvm\lib\ext”*.

3. Update the security restrictions in the server’s *“java.policy”* file. This file is located beneath the Domino program folder in the *“jvm\lib\security”* folder. Edit the file and add the following permission line between the braces where other permissions are granted.

{{{
permission java.util.PropertyPermission "org.apache.commons.logging.simplelog.defaultlog", "write";
}}}

===Configure Notes Agents===
The crawl and feed processes run as agents inside the Connector database. To ensure that the agents can complete without being prematurely terminated by the server’s agent manager, you should increase the *“Max LotusScript/Java execution time”* daytime and nighttime parameters for any server that will be taking part in the crawl and feed process. 

1. Increase the setting in your Domino server document to 360 minutes. This setting can be found in your server document in the *“Agent Manager”* subsection under *“Server tasks”*. The screenshot below shows the *“Agent Manager”* tab in sample server document.

<img src="https://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/AgentSettings.png"/>


2. Restart the Domino server for your changes to take effect.

==GSA Configuration==
===Configure the GSA for Integration===
The GSA will only accept information from your Domino servers if you have first identified them through the GSA admin console. To identify your servers complete the following steps.

*NOTE: All screenshots are from GSA version 6.2. These screens can be con

1. Log into the GSA as a user of type *Administrator*, and selected the "Crawl and Index" menu option. 

2.Complete the “Crawl URLs” section by adding the fully qualified host name of your Domino server. Below you can see how an example server is identified to the Appliance.

<img src="https://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/FollowAndCrawl.png" width="800"/>

*Note: You must include the _"http://"_ prefix and the trailing forward slash _"/"_ *

Note. To find the fully qualified host name of your own servers, refer to the Basics tab of your Server documents in the Domino directory. 

3. Select the “Feeds” option from the “Crawl and Index” menu and confirm that the GSA is ready to accept content from Saturn. Enter any IP Addresses from which the GSA can receive feeds, in a comma-separated format.

===Configure the GSA for Authentication and Authorization===
The Appliance supports a variety of options here including LDAP, forms based authentication, SSO, client certificates, and custom authentication schemes using the SAML standard. By default, the connector will be configured using the connector’s own implementation of the Google Authorization (AuthN) SPI. This implementation will authenticate users against the Domino directory on behalf of the GSA. To configure the GSA to use the Connectors AuthN implementation, complete the following steps.

1. Login to the GSA as an administrator user and select Access Control from the Serving menu. Complete the three fields as described below:

*Authentication - User Login URL*

Enter the URL to the Login form in the Access Control database. The URL should take the form *"https://"* plus the *"fully qualified Domino server hostname/"* plus the *"access control database path"*, and *"/Login?OpenForm"*. For example:

{{{
https://notes.yourdomain.com/google-access-control.nsf/Login?OpenForm  
}}}

*Authentication - Artifact Service URL*

Enter the URL to the authentication agent in the Access Control database. The URL should take the form *"https://"* plus the *"fully qualified Domino server hostname/"* plus the *"access control database path”*, and *"/AuthN?OpenAgent"*. For example:
{{{
https://notes.yourdomain.com/google-access-control.nsf/AuthN?OpenAgent
}}}  
 
*Authorization – Authorization Service URL*

Enter the URL to the authorization agent in the Access Control database. The URL should take the form *"https://"* plus the *"fully qualified Domino server hostname/"* plus the *"access control database path"*, and *"/AuthZ?OpenAgent"*. For example:

{{{
https://notes.yourdomain.com/google-access-control.nsf/AuthZ?OpenAgent
}}}

An example of the Access Control form at the GSA is shown below:

<img src="https://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/Saml.png"/>

*Note: Both HTTP and HTTPS are supported. However, if you use HTTPS you must ensure that the GSA and your Domino servers can communicate over SSL. You should refer to the GSA Help for more details on this subject.*

===Set the serve protocol===

 # From the “Administration” menu, select “SSL Settings”.
 # Set the “Force secure connections when serving?” field to “*Use HTTPS when serving secure results, but not when serving public results.*”.
 # Save these settings with the “Save Setup” button and logout of the GSA admin console.

==Connector Installation==
===Create the Google Enterprise Connector For Lotus Notes databases===
1. Copy the two templates (.NTF files) provided to your Notes client data directory and using the Domino Administrator client, sign them with a trusted ID. 

The ID you sign the template with should have rights to run restricted agents on all servers where the Connector database is to be deployed and at least READER level access to all registered databases and their document sets.

2.Create an instance of the Domino Connector database from the “google-connector.ntf” template in the root Notes data directory on Domino server Saturn.

Upon initial creation the database will automatically open to a new setup form. An example screenshot is provided below.

<img src="https://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/InitialScreen.png"/>

3. Set the appropriate value for your Administrators group, and your log retention period.

*Configure the GSA Settings* 
 # Click on the Google Search Appliance Tab
 # Enter the fully qualified host name of the appliance. The host name should include the Feeder listener’s port number and folder. This is *19900/xmlfeed*. For example 
{{{
gsa.yourdomain.com:19900/xmlfeed
}}}
For more information please refer to the GSA help materials.

2. Select a Security Mechanism,
Important: If you leave the GSA authentication method set to “none” then ALL Notes documents will be sent to the GSA as public documents irrespective of the restrictions on the Notes document itself. Any other setting will ensure that the GSA checks for authorization for each result that does not by default allow reader access to everyone.

It is also worth noting that the Connector crawler will only mark a document as secure for the GSA where security is imposed against the document either through database ACL restrictions, or document level readers/authors fields, or a combination of both. If a document does not have security imposed, it will be marked as public when it is sent to the GSA.

The Connector also respects groups and application specific database roles when deciding who has reader access to each Notes document.

An example of a completed Google Search Appliance tab is shown below.

<img src="https://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/GSATab.png"/>

*Configure your Domino Servers in the Connector*
The Connector has a built in awareness of the servers in your Domino Organization. It uses this awareness to build the fully qualified URLs to each source document and attachment. The system also uses the server lists to build replica server lists for each database as you register them with the system. 

<img src="https://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/DominoServer.png"/>

Before a database can be registered with the connector for crawling, the host server must first have been defined in a region document. 

1. Click the "Add Region" button. The new region form will be displayed.

<img src="https://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/Region.png"/>

2. Enter a descriptive name for the region; e.g. *{{{CorpDomain}}}*

3. Enter the domain name for the region.

4. Select the appropriate servers from the list of servers in your Domino directory using the button provided. The screenshot below shows the completed region document.

5. Press the “Save and Exit” button to return to the system setup form. 




