#summary Install the Google Enterprise Connector for Lotus Notes
#labels Featured,Phase-Deploy

= Installation Instructions =
The *Google Enterprise Connector For Lotus Notes* is installed entirely on your Domino infrastructure. 

You should install the connector to a domino server to which you have administrative access.

== Pre-Installation Steps - ==
===Lotus Notes Environment Preparation===
You will need to complete the following tasks to install the connector.

===Install Dependent Java Libraries===
The Connector uses the Jakarta Commons HttpClient software to post content to the GSA so before any feeding can begin, these files must be copied to your Domino Server.

1. Download the Commons clients from the [http://hc.apache.org/httpclient-3.x/ Jakarta HTTP Client home page]. 

You will need the following jars:
 * commons-codec-1.3.jar
 * commons-httpclient-3.0.jar
 * commons-logging.jar

_*Note:* You only need to deploy the jars to the Domino server on which the Connector is hosted. You do NOT need to deploy them to every Domino server._

2. Copy them to your Domino Server's external Java classes’ folder. On a Microsoft Windows platform, this folder is the *“jvm\lib\ext”* folder, which is located beneath the Domino program folder. For example: If you install Domino to *“C:\Lotus\Domino”*, you would copy your jar files to: *“C:\Lotus\Domino\jvm\lib\ext”*.

3. Update the security restrictions in the server’s *“java.policy”* file. This file is located beneath the Domino program folder in the *“jvm\lib\security”* folder. Edit the file and add the following permission line between the braces where other permissions are granted.

{{{
permission java.util.PropertyPermission "org.apache.commons.logging.simplelog.defaultlog", "write";
}}}

===Configure Notes Agents===
The crawl and feed processes run as agents inside the Connector database. To ensure that the agents can complete without being prematurely terminated by the server’s agent manager, you should increase the *“Max Lotusscript`/`Java execution time”* daytime and nighttime parameters for any server that will be taking part in the crawl and feed process. 

1. Increase the setting in your Domino server document to 360 minutes or higher. This setting can be found in your server document in the *“Agent Manager”* subsection under *“Server tasks”*. The screenshot below shows the *“Agent Manager”* tab in sample server document.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/AgentSettings.png"/>


2. Restart the Domino server for your changes to take effect.

==GSA Configuration==
===Configure the GSA for Integration===
The GSA will only accept information from your Domino servers if you have first identified them through the GSA admin console. To identify your servers complete the following steps.

*NOTE: All screenshots are from GSA version 6.2. These screens are illustrative only, as the Google Enterprise Connector For Lotus Notes is backwards compatible with all supported versions.

1. Log into the GSA as a user of type *Administrator*, and selected the "Crawl and Index" menu option. 

2.Complete the “Crawl URLs” section by adding the fully qualified host name of your Domino server. Below you can see how an example server is identified to the Appliance.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/FollowAndCrawl.png" width="800"/>

*Note: You must include the _"http://"_ prefix and the trailing forward slash _"/"_ *

Note. To find the fully qualified host name of your own servers, refer to the Basics tab of your Server documents in the Domino directory. 

3. Select the “Feeds” option from the “Crawl and Index” menu and confirm that the GSA is ready to accept content from your Notes server. Enter any IP Addresses from which the GSA can receive feeds, in a comma-separated format.

===Configure the GSA for Authentication and Authorization===
The Appliance supports a variety of options here including LDAP, forms based authentication, SSO, client certificates, and custom authentication schemes using the SAML standard. By default, the connector will be configured using the connector’s own implementation of the Google Authorization (AuthN) SPI. This implementation will authenticate users against the Domino directory on behalf of the GSA. To configure the GSA to use the Connectors AuthN implementation, complete the following steps.

1. Login to the GSA as an administrator user and select Access Control from the Serving menu. Complete the three fields as described below:

*Authentication - User Login URL*

Enter the URL to the Login form in the Access Control database. The URL should take the form *"https://"* plus the *"fully qualified Domino server hostname/"* plus the *"access control database path"*, and *"/Login?OpenForm"*. For example:

{{{
https://notes.yourdomain.com/google-access-control.nsf/Login?OpenForm  
}}}

*Authentication - Artifact Service URL*

Enter the URL to the authentication agent in the Access Control database. The URL should take the form *"https://"* plus the *"fully qualified Domino server hostname/"* plus the *"access control database path”*, and *"/AuthN?OpenAgent"*. For example:
{{{
https://notes.yourdomain.com/google-access-control.nsf/AuthN?OpenAgent
}}}  
 
*Authorization – Authorization Service URL*

Enter the URL to the authorization agent in the Access Control database. The URL should take the form *"https://"* plus the *"fully qualified Domino server hostname/"* plus the *"access control database path"*, and *"/AuthZ?OpenAgent"*. For example:

{{{
https://notes.yourdomain.com/google-access-control.nsf/AuthZ?OpenAgent
}}}

NOTE : While configuring the Connector SAML for nonlegacy mode, the IDP Entity ID Value to be given  is "LotusSAMLIssuer"

An example of the Access Control form at the GSA is shown below:

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/Saml.png"/>

*Note: Both HTTP and HTTPS are supported. However, if you use HTTPS you must ensure that the GSA and your Domino servers can communicate over SSL. You should refer to the GSA Help and your Domino Administration Help database for more details on this subject.*

===Set the serve protocol===

 # From the “Administration” menu, select “SSL Settings”.
 # Set the “Force secure connections when serving?” field to “*Use HTTPS when serving secure results, but not when serving public results.*”.
 # Save these settings with the “Save Setup” button and logout of the GSA admin console.

_*Note*: If you want to use the custom stylesheet optimized for the Notes Connector, you should upload this to your frontend of choice on the GSA via Serving > Front Ends, using the stylesheet file *domino_stylesheet.xslt*. This is an example stylesheet that shows how you can use the meta data sent from the connector to server custom results at the GSA. Note: This stylesheet does not consider any other result type except Notes so it will need to be modified to present other data sources at the GSA in any production environment. 

==Connector Installation==
===Create the Google Enterprise Connector For Lotus Notes databases===
1. Copy the two templates (.NTF files) provided to your Notes client data directory

2. Rename the file "google-access-control-xxx.ntf" to "google-access-control.ntf"

3. Using the Domino Administrator client, sign them with a trusted ID. 

4.	Before creating the database, the connector templates (google-connector.ntf and google-access-control.ntf) in the Domino Data  folder, need to be signed using the ID of the user that is going to run the connector using the Domino Administrator
    Steps to sign the template
     
     a.	Sign in to  the Domino Administrator with the User ID of the user that is going to run the connector

     b.	Click on the “google-connector.ntf”

     c.	Click on Tools-->Database-->Sign

     d.	Click on OK


<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/SignTemplate.JPG"/>

The ID you sign the template with should have rights to run restricted agents on all servers where the Connector database is to be deployed and at least READER level access to all registered databases and their document sets.

5.Create an instance of the Domino Connector database from the “google-connector-xxx.ntf” template in the root Notes data directory on your Domino server.

Upon initial creation the database will automatically open to a new setup form. An example screenshot is provided below.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/InitialScreen.png"/>

6. Set the appropriate value for your Administrators group, and your log retention period.

7. Specify the User ID in the Programmability Restrictions section of the Current Server Document.
Current Server Document-->Security-->Programmability Restrictions

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/AgentSignPriv.JPG"/>

===Configure the GSA Settings===
 # Click on the Google Search Appliance Tab
 # Enter the fully qualified host name of the appliance. The host name should include the Feeder listener’s port number and folder. This is *19900/xmlfeed*. For example 
{{{
gsa.yourdomain.com:19900/xmlfeed
}}}
For more information please refer to the GSA help materials.

2. Select a Security Mechanism,
Important: If you leave the GSA authentication method set to “none” then ALL Notes documents will be sent to the GSA as public documents irrespective of the restrictions on the Notes document itself. Any other setting will ensure that the GSA checks for authorization for each result that does not by default allow reader access to everyone.

It is also worth noting that the Connector crawler will only mark a document as secure for the GSA where security is imposed against the document either through database ACL restrictions, or document level readers/authors fields, or a combination of both. If a document does not have security imposed, it will be marked as public when it is sent to the GSA.

The Connector also respects groups and application specific database roles when deciding who has reader access to each Notes document.

An example of a completed Google Search Appliance tab is shown below.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/GSATab.png"/>

===Configure your Domino Servers in the Connector===

The Connector has a built in awareness of the servers in your Domino Organization. It uses this awareness to build the fully qualified URLs to each source document and attachment. The system also uses the server lists to build replica server lists for each database as you register them with the system. 

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/DominoServer.png"/>

Before a database can be registered with the connector for crawling, the host server must first have been defined in a region document. 

1. Click the "Add Region" button. The new region form will be displayed.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/Region.png"/>

2. Enter a descriptive name for the region; e.g. *{{{CorpDomain}}}*

3. Enter the domain name for the region.

4. Select the appropriate servers from the list of servers in your Domino directory using the button provided. The screenshot below shows the completed region document.

5. Press the “Save and Exit” button to return to the system setup form. 

===Configure Access Control===

1. Ensure that the filename of your organisation’s Domino Directory is correct. The default is “names.nsf” and in most cases this will not need to be changed. If you are unsure, check with your Domino Administrator.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/AccessControl.png"/>

2. To limit the number of users cached by the access control system, enter a standard Notes document selection formula into the User selection formula field. Tip: Where you have a large number of users (>25,000 users) and your testing is restricted to just a subset of those users, entering a selection formula here will offer optimum “Directory Monitor” performance as it prevents the system from caching unnecessary user details.

3. If you are using the Domino’s own authentication with the name that a user is known by at the GSA will match that user’s Notes name, you can leave the “Formula to use to generate user name field “ blank. Otherwise enter a Formula that can be used to map the Domino name to the username correctly. 

4. Press the “Create Access Control Database” button. The access control database will now be created on your Domino server. The Access Control tab will now refresh and you will see the “Open Access Control Database” button. You can of course open the database when you need to using the “File-Database-Open” menu option from your Notes Client. 

It is recommended that you now open the access control database, and select the System Setup menu option to reveal the access control setup profile. 
  *Access Control Database Setup*

On the General Settings, enter the GSA Address and click on "Save"
In the Security Manager Artifact consumer URL, enter the GSA Address and the Security Manager Assertion Consumer 

URL. In case of Legacy AuthN Mode of the GSA is being used, give the URL as 
https://< gsa>/security-manager/SamlArtifactConsumer 

Else in case of normal SM, give the URL as -
https://< gsa>//security-manager/samlassertionconsumer

Click on "Save" 


<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/SM_AssertionURL.jpg"/>



5. Click on the Advanced tab and enable the logging of authorization requests as shown below. This allows the system to record each incoming request from the GSA and the response. This is particularly useful for checking the incoming username format provided by the GSA.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/AdvancedAccess.png"/>

_*Note*: Whilst this feature is useful for checking your configuration, the logging of authorization requests should not be used in a production environment for performance reasons._

Typically you should leave the "*Response to send for non Notes resources*" to *indeterminate" so that the GSA will revert to it's default Authorization  mechanism.

6. Press the “Save and Exit” button to close the Access Control database set-up profile. Within an hour the Directory Monitor will have run and built the necessary cache information about your users and groups so that is can handle incoming authorization requests from the GSA.

_*Tip*: You can also run the Directory Monitor at any time using the “Update Now” action button that can be found in the People and Groups views._

_*Note*: The authorization mechanism respects usernames and group names in database ACLs and any Reader/Authors items at the document level. The system also respects application specific roles. Respect for group membership includes implicit as well as explicit group membership. Explicit group membership is where a user is listed directly as a group member. Implicit group membership is where a user can be found in any descendant group. For example: John Smith is considered to a member of “Sales-Global” through his explicit membership of “Sales-APAC” if “Sales-APAC” is a member of “Sales-Global”._

7. Once you have returned to the Connector’s setup profile, press the “Save and Exit” button to close the setup profile in the Connector database. 

You are now ready to begin registering databases with the connector.

===Register Databases to be Searched===

Before a database can be crawled by the system a database parameters document must exist. Databases can be registered one at a time, in bulk, or using the API provided. For more details you should refer to the full Installation and Administration guide. In this scenario, we will register the Domino Directory to demonstrate the process.

To register a new database, complete the following steps.

1. Select "Databases" from the Connector menu.

2. Click the "New-Database" button. The new database form will be displayed.

3. Select the Domino Directory from your Domino server using the button provided. 

4. Select the template to apply to this database using the button provided. See [Templates templates] for more information about template selection.

5. Save the database using the button provided and exit. The next time the crawler runs the desired content will be added to the system. An example of the completed database parameters document is shown below:

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/Database.png"/>

You are encouraged to read the page that covers [Templates template profile management] to gain a full appreciation of the options that are available to in the areas of selective indexing and document transformation.

===Checking the Crawler===

Once the crawler has run, the databases view will be updated to show the numbers of documents indexed and when as shown in the screenshot below.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/DBCount.png"/> 

In addition you can refer to the “Submitted” view to see the document stubs that are retained in the connector that support the ongoing synchronization between the original Notes database and the Appliance. The submitted view following the crawling of our Domino Directory is shown below.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/Submitted.png"/> 

From the “Submitted” view, you can open the summary document to get more detailed information. To do this select a document and press the “Open” action bar button, and then choose Summary details. The summary document will be displayed as shown in the screenshot below.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/DocSummary.PNG"/>

From here you can view the details that are retained in the connector. The security tab shows which users and groups have reader or above access to this document. An example is shown below.

<img src="http://google-enterprise-connector-notes.googlecode.com/svn/trunk/res/DocSecurity.png"/>
 
You will note that because there are values in the Readers token, that the GSA authentication method is set to “httpbasic”. This ensures that the GSA will seek authorization from Domino before showing this document to any user in the search results.